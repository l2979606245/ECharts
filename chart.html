<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>ECharts</title>
    <!-- 引入 echarts.js -->
    <script src="echarts.min.js"></script>
</head>

<body>
    <!-- 为 ECharts 准备一个具备大小（宽高）的 Dom -->
    <div id="main" style="width: 1000px; height: 400px;"></div>
    <script>
        var log = console.log.bind(console)
        var ajax = (request) => {
            // var { method, url, data, callback, contentType } = request
            var r = new XMLHttpRequest()
            r.open(request.method, request.url, true)
            if (request.contentType != undefined) {
                r.setRequestHeader('Content-Type', request.contentType)
            }
            r.onreadystatechange = function () {
                if (r.readyState == 4) {
                    request.callback(r.response)
                }
            }
            if (request.method == 'GET') {
                r.send()
            } else {
                r.send(request.data)
            }
        }
        // 基于准备好的 dom，初始化 echarts 实例
        var element = document.querySelector('#main')
        var myChart = echarts.init(element)



        var request = {
            method: 'GET',
            url: 'https://free-api.heweather.com/s6/weather/now?location=%E5%93%88%E5%B0%94%E6%BB%A8&key=4d9894b3a8204d3bb9296232c7251232',
            callback: (response) => {
                // 不考虑错误情况（断网、服务器返回错误等等）
                // console.log('响应', response)
                var weather = JSON.parse(response)
                log('w', weather)
                var s = weather['HeWeather6'][0]['now']
            var values = Object.values(s).slice(0, 8)
            var keys = Object.keys(s).slice(0, 8)
            // log(response)
            // 指定图表的配置项和数据
            log(values, keys)
            var option = {
                title: {
                    text: '中国天气'
                },
                tooltip: {},
                legend: {
                    data: ['天气预报']
                },
                xAxis: {
                    data:keys                  
                },
                yAxis: {},
                series: [{
                    name: '天气预报',
                    type: 'bar',
                    data: values,
                }]
            }
            // 使用刚指定的配置项和数据显示图表。
            myChart.setOption(option)
            }
        }
        
        var __main = () => {
            ajax(request)
        }
        __main()
    </script>
</body>

</html>